<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Interactive Flipbook</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"
      rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <style>
      :root {
        --book-width: 900px;
        --book-height: 600px;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: #f9fafb;
        color: #374151;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        overflow: hidden;
      }

      .container {
        text-align: center;
        padding: 2rem;
        max-width: var(--book-width);
        width: 100%;
      }

      h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: #1f2937;
      }

      p.subtitle {
        font-size: 1rem;
        color: #6b7280;
        margin-bottom: 2rem;
      }

      .book-container {
        width: var(--book-width);
        height: var(--book-height);
        position: relative;
        perspective: 2500px;
        margin: 0 auto;
        border-radius: 1rem;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        cursor: pointer;
      }

      .book {
        width: 100%;
        height: 100%;
        position: relative;
        transform-style: preserve-3d;
        transform-origin: center;
      }

      .page-pair {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        transform-style: preserve-3d;
        transition: transform 0.8s ease-in-out;
        backface-visibility: hidden;
        display: flex;
      }

      .page {
        width: 50%;
        height: 100%;
        background-color: #f3f4f6;
        transform-style: preserve-3d;
        backface-visibility: hidden;
        border: 1px solid #e5e7eb;
        box-sizing: border-box;
        overflow: hidden;
      }

      .page-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        backface-visibility: hidden;
      }

      .left-page {
        border-right: none;
      }

      .right-page {
        border-left: none;
      }

      .flip-page {
        position: absolute;
        width: 50%;
        height: 100%;
        right: 0;
        top: 0;
        background-color: #f3f4f6;
        transform-style: preserve-3d;
        transform-origin: left;
        transition: transform 0.8s ease-in-out;
        z-index: 100;
      }

      .flip-front,
      .flip-back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
      }

      .flip-back {
        transform: rotateY(180deg);
      }

      .page-pair.turned .flip-page {
        transform: rotateY(-180deg);
      }

      .btn {
        background-color: #3b82f6;
        color: white;
        padding: 1rem 2rem;
        border-radius: 9999px;
        border: none;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        margin-top: 2rem;
      }

      .btn:hover {
        background-color: #2563eb;
        transform: translateY(-2px);
        box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
      }

      .hidden {
        display: none;
      }

      .controls {
        position: absolute;
        top: 1rem;
        right: 1rem;
        display: flex;
        gap: 1rem;
      }

      .control-btn {
        background: #fff;
        color: #3b82f6;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.25rem;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .popup {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }

      .popup-content {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        max-width: 500px;
        text-align: left;
      }

      .close {
        float: right;
        cursor: pointer;
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 1.5rem;
        z-index: 2000;
        text-align: center;
      }

      .welcome-page {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("https://placehold.co/1200x800/e0f2fe/0c4a6e?text=Welcome+Page") no-repeat
          center center/cover;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        z-index: 3000;
      }
    </style>
  </head>
  <body>
    <div class="welcome-page" id="welcomePage">
      <h1 style="color: white; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5)">Tap to begin</h1>
    </div>

    <div class="container hidden" id="flipbook-container">
      <div class="controls">
        <button id="playBtn" class="control-btn"><i class="fa fa-play-circle-o"></i></button>
        <button id="fullScreenButton" class="control-btn"><i class="fa fa-arrows-alt"></i></button>
      </div>
      <div class="book-container">
        <div class="book" id="book">
          <!-- Pages will be dynamically added here by JavaScript -->
        </div>
      </div>
    </div>

    <div id="info-popup" class="popup">
      <div class="popup-content">
        <span class="close" data-popup="info-popup">&times;</span>
        <h2>About This Flipbook</h2>
        <p>
          This is a dynamic photo album created with HTML, CSS, and JavaScript. You can turn pages
          by clicking on the book itself.
        </p>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const welcomePage = document.getElementById("welcomePage");
        const flipbookContainer = document.getElementById("flipbook-container");
        const bookElement = document.getElementById("book");
        const playBtn = document.getElementById("playBtn");
        const fullScreenButton = document.getElementById("fullScreenButton");
        const body = document.getElementsByTagName("body")[0];

        // Placeholder Data (to make the code runnable)
        const numPages = 8;
        const pageRatio = 0.75;
        const pageOrientation = "portrait";
        const folderPath = "https://placehold.co";
        const folderName = "450x600";
        const frontCoverImg = "450x600/e0f2fe/0c4a6e?text=Front+Cover";
        const backCoverImg = "450x600/0f172a/f8fafc?text=Back+Cover";
        const innerSheetArray = [
          "450x600/bfdbfe/1e40af?text=Page+1",
          "450x600/cffafe/0f766e?text=Page+2",
          "450x600/fecdd3/9f1239?text=Page+3",
          "450x600/dbeafe/1e40af?text=Page+4",
          "450x600/fef08a/b45309?text=Page+5",
          "450x600/a3e635/365314?text=Page+6",
          "450x600/fdba74/c2410c?text=Page+7",
          "450x600/4c0519/f8fafc?text=Page+8",
        ];
        const isCropped = true;

        // Audio Setup (using placeholder URLs)
        const bgMsc = new Audio(`https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3`);
        bgMsc.loop = true;

        const turnAudio = new Audio("https://s3-us-west-2.amazonaws.com/s.cdpn.io/3/page-turn.mp3");
        turnAudio.loop = false;

        const intrucAudio = new Audio(
          "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"
        );
        intrucAudio.loop = false;

        welcomePage.addEventListener("click", function () {
          intrucAudio
            .play()
            .then(() => {
              welcomePage.classList.add("hidden");
              flipbookContainer.classList.remove("hidden");
              renderBook();
            })
            .catch((e) => console.error("Error playing welcome audio:", e));
        });

        playBtn.addEventListener("click", function () {
          if (bgMsc.paused) {
            bgMsc.play();
            playBtn.innerHTML = '<i class="fa fa-pause-circle-o"></i>';
            playBtn.style.color = "darkgreen";
          } else {
            bgMsc.pause();
            playBtn.innerHTML = '<i class="fa fa-play-circle-o"></i>';
            playBtn.style.color = "red";
          }
        });

        // Other setting like ratio, etc
        let firstHalf = 0;

        if (numPages % 2 !== 0) {
          // If the number is odd
          firstHalf = Math.floor(numPages / 2) + 1;
        } else {
          // If the number is even
          firstHalf = Math.floor(numPages / 2);
        }

        bookElement.style.aspectRatio = pageRatio;
        if (pageOrientation === "portrait") {
          bookElement.classList.add("portrait");
        }

        // Function to create a page
        function createPage(className, frontImgSrc, backImgSrc, id, count, reverseCount) {
          const page = document.createElement("div");
          page.className = `page-pair ${className}`;
          page.style.zIndex = reverseCount;
          page.id = id;

          if (count > firstHalf + 1) {
            page.classList.add("last-half");
          } else {
            page.classList.add("first-half");
          }

          const leftPage = document.createElement("div");
          leftPage.className = "page left-page";
          if (frontImgSrc) {
            leftPage.innerHTML = `<img src="${folderPath}/${folderName}/${frontImgSrc}" alt="Page ${count}" class="page-image">`;
          } else {
            leftPage.classList.add("blank");
          }

          const rightPageContainer = document.createElement("div");
          rightPageContainer.className = "page right-page";

          const flipPage = document.createElement("div");
          flipPage.className = "flip-page";

          const flipFront = document.createElement("div");
          flipFront.className = "flip-front";
          if (backImgSrc) {
            flipFront.innerHTML = `<img src="${folderPath}/${folderName}/${backImgSrc}" alt="Page ${
              count + 1
            }" class="page-image">`;
          } else {
            flipFront.classList.add("blank");
          }

          const flipBack = document.createElement("div");
          flipBack.className = "flip-back";
          const nextLeftImage = innerSheetArray[count % innerSheetArray.length];
          flipBack.innerHTML = `<img src="${folderPath}/${folderName}/${nextLeftImage}" alt="Next Left Page" class="page-image">`;

          flipPage.appendChild(flipFront);
          flipPage.appendChild(flipBack);
          rightPageContainer.appendChild(flipPage);

          page.appendChild(leftPage);
          page.appendChild(rightPageContainer);

          return page;
        }

        // Create pages dynamically
        function renderBook() {
          bookElement.innerHTML = "";
          // Front cover
          const frontCover = createPage(
            "front-cover",
            frontCoverImg,
            innerSheetArray[0],
            "frontCover",
            1,
            numPages + 2
          );
          bookElement.appendChild(frontCover);

          // Inner pages
          for (let i = 0; i < innerSheetArray.length - 1; i += 2) {
            const pageId = `page${i / 2 + 1}`;
            const frontImgSrc = innerSheetArray[i];
            const backImgSrc = innerSheetArray[i + 1];
            const page = createPage(
              "inner",
              frontImgSrc,
              backImgSrc,
              pageId,
              i + 2,
              numPages + 1 - i
            );
            bookElement.appendChild(page);
          }

          // Back cover
          const backCover = createPage(
            "back-cover",
            innerSheetArray[innerSheetArray.length - 1],
            backCoverImg,
            "backCover",
            numPages + 2,
            1
          );
          bookElement.appendChild(backCover);

          // Add click listeners to all pages after they are created
          const allPages = bookElement.querySelectorAll(".page-pair");
          allPages.forEach((page, index) => {
            page.addEventListener("click", () => handlePageClick(page, index));
          });
        }

        // handle click events
        function handlePageClick(clickedPage, index) {
          if (clickedPage.classList.contains("turned")) {
            // To go backward
            if (index > 0) {
              const prevPage = bookElement.children[index - 1];
              prevPage.classList.remove("turned");
              turnAudio.play();
            }
          } else {
            // To go forward
            if (index < bookElement.children.length - 1) {
              clickedPage.classList.add("turned");
              turnAudio.play();
            }
          }
        }

        // Full screen toggle
        function toggleFullScreen(element) {
          if (!document.fullscreenElement) {
            element.requestFullscreen().catch((err) => {
              console.error("Error attempting to enable full-screen mode:", err);
            });
          } else {
            document.exitFullscreen();
          }
        }

        fullScreenButton.addEventListener("click", function () {
          toggleFullScreen(body);
        });

        // Popup
        const openButtons = document.querySelectorAll(".open-popup");
        openButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const popupId = this.getAttribute("data-popup");
            document.getElementById(popupId).style.display = "flex";
          });
        });

        const closeButtons = document.querySelectorAll(".close");
        closeButtons.forEach((button) => {
          button.addEventListener("click", function () {
            const popupId = this.getAttribute("data-popup");
            document.getElementById(popupId).style.display = "none";
          });
        });

        window.addEventListener("click", function (event) {
          if (event.target.classList.contains("popup")) {
            event.target.style.display = "none";
          }
        });

        document.addEventListener("visibilitychange", function () {
          if (document.hidden && !bgMsc.paused) {
            bgMsc.pause();
          }
        });
      });
    </script>
  </body>
</html>
